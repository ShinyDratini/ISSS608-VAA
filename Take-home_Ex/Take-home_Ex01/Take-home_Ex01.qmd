---
title: "Take-home Exercise 1: Ship Performance in the Gulf of Guinea"
author: "Justin"
date: "February 01, 2025"
date-modified: "last-modified" 
---

:::{.center}
![Cargo ship on sea by Anastasios Antoniadis](g.jpg)
:::

# Overview

## Setting the Scene

The Gulf of Guinea is a region abundant in natural resources, including oil, gas, and valuable minerals. It serves as a crucial shipping corridor, facilitating the transportation of commodities to and from Central and Southern Africa. However, it is also one of the world’s most dangerous maritime regions, plagued by piracy and security threats. In 2020, there were 78 piracy incidents, with 130 seafarers kidnapped for ransom, making it a key concern for global trade and maritime security.

## Task

This study aims to analyze the correlation between various factors affecting ship performance and revenue generation in the Gulf of Guinea. By identifying key influences on operational efficiency and profitability, the findings will help government officials and maritime stakeholders develop strategies to enhance ship performance, mitigate risks, and optimize trade efficiency in the region.

# Getting Started

## Load the packages

We load the following R packages using the pacman::p_load() function:

| Library | Description |
|-----------------------------------|-------------------------------------|
| [tidyverse](https://www.tidyverse.org/) | A collection of packages designed for data science in R. (ggthemes, tidymodels, lubridate, knitr, dplyr) |
| [ggplot2](https://ggplot2.tidyverse.org/) | Extensions such as ggHoriPlot, ggstatsplot, ggridges, ggdist |
| [corrplot](https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html) | Used for correlation matrix visualisation. |
| [car](https://www.geeksforgeeks.org/car-package-in-r/) | Companion to Applied Regression, used for statistical analysis. |
| [plotly](https://plotly.com/) | Used to create interactive plots. |
| [colorspace](https://cran.r-project.org/web/packages/colorspace/vignettes/colorspace.html)  | Used in colour manipulation for visualisations. |

```{r}
#| echo: false
pacman::p_load(readr, viridis, SmartEDA, tidyverse, tidymodels, lubridate, 
               knitr, dplyr, ggplot2, ggHoriPlot, ggthemes, corrplot, ggstatsplot,
               ggdist, ggridges, car, plotly,
               colorspace, crosstalk, scales)
```

## Data Source and Data Importing

Ship performance clustering dataset from [Kaggle](https://www.kaggle.com/datasets/jeleeladekunlefijabi/ship-performance-clustering-dataset) was used. The dataset is tailored for maritime data analytics. This dataset contains 2736 rows and 24 columns with feature categorized into numerical and categorical types.

First we read the CSV file with proper column type specification

| Numerical Features | Description |
|-------------------------------------------|-----------------------------|
| Speed_Over_Ground_Knots | Average speed of the ship over water (in knots). |
| Engine_Power_kW | Engine power output (in Kilowatts). |
| Distance_Traveled_nm | The total distance travelled by the ship (in nautical miles). |
| Operational_Cost_USD | Total operational cost per voyage (in USD). |
| Revenue_per_Voyage_USD | Revenue generated per voyage (in USD). |
| Efficiency_nm_per_kWh | Energy efficiency calculated in nautical miles per kilowatt-hour. |

| Categorical Features | Description |
|---------------------------------------------|---------------------------|
| Ship_Type | Type of ship used for transport. |
| Route_Type | Type of shipping route (e.g., Coastal, Long-haul, etc.). |
| Engine_Type | Type of engine used in the ship. |
| Maintenance_Status | Maintenance condition of the ship. |
| Weather_Condition | Weather conditions during voyages. |

```{r}
#| echo: false
# Read CSV file with proper column type specification
df <- read_csv("data/Ship_Performance_Dataset.csv", col_types = cols(Date = col_date(format = "%Y-%m-%d")))

# Check if Date conversion was successful
str(df)
```

## Data Pre-processing

From the summary statistics of the dataset, it is observed that there are missing values 'none' in the dataset.

```{r}
#| echo: false
# 1️⃣ Check if the Date column has missing values
sum(is.na(df$Date))  # Should return the count of NA values in Date column

# 2️⃣ Identify columns containing "None" (excluding Date column)
cols_with_none <- colnames(df)[sapply(df, function(x) {
  if (is.character(x) || is.factor(x)) {  # Ensure we check only character/factor columns
    any(x == "None", na.rm = TRUE)
  } else {
    FALSE
  }
})]

# 3️⃣ Replace "None" with NA only in identified columns
df[cols_with_none] <- lapply(df[cols_with_none], function(x) replace(x, x == "None", NA))

# 4️⃣ Verify missing values in each column
colSums(is.na(df))
```

```{r}
#| echo: false
rows_with_na <- sum(!complete.cases(df))  # More efficient than apply()
print(paste("Number of rows with at least one NA:", rows_with_na))

# Define total_rows before using it
total_rows <- nrow(df)

percentage_na_rows <- (rows_with_na / total_rows) * 100
print(paste("Corrected Percentage of rows with missing values:", round(percentage_na_rows, 2), "%"))

```
Since the total missing values is \>5% of total rows, removing them will significantly impact the dataset. Therefore, we will not be removing rows containing None.

```{r}
categorical_cols <- c("Ship_Type", "Route_Type", "Engine_Type", "Maintenance_Status", "Weather_Condition")  # List of categorical columns
df[categorical_cols] <- lapply(df[categorical_cols], function(x) ifelse(is.na(x), "Unknown", x))
```


Next, binning and feature engineering will be done before analysis is done.

To improve trend analysis and facilitate meaningful comparisons, the dataset was binned into Month perios. This helps to identify seasonality and trends in voyages while reducing noise from daily fluctuations. A Profit column was introduced to measure voyage profitability, enabling insights into cost efficiency and revenue impact over time.

```{r}
# Create a new column for Year-Month binning
df <- df %>%
  mutate(Month = floor_date(Date, "month")) %>%  # Truncate date to the first day of the month 
  mutate(Profit = Revenue_per_Voyage_USD - Operational_Cost_USD)  # Calculate profit
```

```{r}
#| echo: false
str(df)
```

# Visualization & Analysis

### Monthly Profit by Ship Type

```{r}
#| echo: false
# Create the ggplot object
p <- ggplot(df, aes(x = Month, y = Profit, fill = Ship_Type, text = paste("Ship Type:", Ship_Type, "<br>Profit:", Profit))) +
  geom_bar(stat = "identity", position = "stack") +  
  labs(title = "Monthly Profit by Ship Type",
       x = "Month", y = "Profit (USD)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Convert to interactive plot
ggplotly(p, tooltip = "text")
```

The chart represents the monthly profit distribution across different ship types. It allows for easy comparison of how much each ship type contributes to the total profit in different months.
Bulk Carriers contribute the most to overall profit across all months.
There are variations in monthly profits with some months (e.g., March 2024) that have higher toal profit than others (eg. January 2024)

```{r}
#| code-fold: true
#| code-summary: "Click here to show the R code"
#| eval: false
# Create the ggplot object
p <- ggplot(df, aes(x = Month, y = Profit, fill = Ship_Type, text = paste("Ship Type:", Ship_Type, "<br>Profit:", Profit))) +
  geom_bar(stat = "identity", position = "stack") +  
  labs(title = "Monthly Profit by Ship Type",
       x = "Month", y = "Profit (USD)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Convert to interactive plot
ggplotly(p, tooltip = "text")
```

### Cargo weight on Profitability

```{r}
#| echo: false
# Scatter plot with regression line and viridis colors
ggplot(df, aes(x = Cargo_Weight_tons, y = Profit, color = Ship_Type)) +
  geom_point(alpha = 0.6, size = 3) +  # Scatter points
  geom_smooth(method = "lm", se = FALSE) +  # Linear trend line
  facet_wrap(~Route_Type) +  # Facet by Route Type
  scale_color_viridis_d(option = "plasma") +  # Use viridis color scheme
  labs(title = "Effect of Cargo Weight on Profitability",
       x = "Cargo Weight (tons)", y = "Profit (USD)", color = "Ship Type") +
  theme_minimal()
```
This chart visualizes the Effect of Cargo Weight on Profitability, segmented by Route Type and Ship Type. 

X-Axis represents total cargo weight
Y-Axis represents profitability monthly

It is observed that most ship type profit increase as cargo weight increases.

```{r}
#| code-fold: true
#| code-summary: "Click here to show the R code"
#| eval: false
# Scatter plot with regression line and viridis colors
ggplot(df, aes(x = Cargo_Weight_tons, y = Profit, color = Ship_Type)) +
  geom_point(alpha = 0.6, size = 3) +  # Scatter points
  geom_smooth(method = "lm", se = FALSE) +  # Linear trend line
  facet_wrap(~Route_Type) +  # Facet by Route Type
  scale_color_viridis_d(option = "plasma") +  # Use viridis color scheme
  labs(title = "Effect of Cargo Weight on Profitability",
       x = "Cargo Weight (tons)", y = "Profit (USD)", color = "Ship Type") +
  theme_minimal() 
```
## Correlation Analysis with Revenue per Voyage (USD)

```{r}
#| echo: false
# Select only numerical columns for correlation
num_data <- df[, sapply(df, is.numeric)]

# Compute correlation matrix
cor_matrix <- cor(num_data, use = "complete.obs")

# Display correlation with Revenue_per_Voyage_USD
cor_with_revenue <- cor_matrix[, "Revenue_per_Voyage_USD"]

# Sort by highest correlation
sorted_cor <- sort(cor_with_revenue, decreasing = TRUE)
print(sorted_cor)
```
The correlation matrix above shows how different numerical variables relate to Revenue per Voyage (USD). Correlation values range from -1 to 1:

1 → Perfect positive correlation
0 → No correlation
-1 → Perfect negative correlation

From the Correlation Matrix, we can observe that none of the numerical variables have strong linear relationships with revenue.

```{r}
#| code-fold: true
#| code-summary: "Click here to show the R code"
#| eval: false
# Select only numerical columns for correlation
num_data <- df[, sapply(df, is.numeric)]

# Compute correlation matrix
cor_matrix <- cor(num_data, use = "complete.obs")

# Display correlation with Revenue_per_Voyage_USD
cor_with_revenue <- cor_matrix[, "Revenue_per_Voyage_USD"]

# Sort by highest correlation
sorted_cor <- sort(cor_with_revenue, decreasing = TRUE)
print(sorted_cor)
```

## Profitability Analysis

```{r}
#| echo: false
df_new <- df %>%
  mutate(Profit_per_Voyage_USD = Revenue_per_Voyage_USD - Operational_Cost_USD)

# Analyze Profit by Ship_Type
profit_by_ship_type <- df_new %>%
  group_by(Ship_Type) %>%
  summarise(Average_Profit = mean(Profit_per_Voyage_USD),
            Total_Profit = sum(Profit_per_Voyage_USD),
            Count = n())

# Analyze Profit by Engine_Type
profit_by_engine_type <- df_new %>%
  group_by(Engine_Type) %>%
  summarise(Average_Profit = mean(Profit_per_Voyage_USD),
            Total_Profit = sum(Profit_per_Voyage_USD),
            Count = n())

# Analyze Profit by Route_Type
profit_by_route_type <- df_new %>%
  group_by(Route_Type) %>%
  summarise(Average_Profit = mean(Profit_per_Voyage_USD),
            Total_Profit = sum(Profit_per_Voyage_USD),
            Count = n())

# Display results
print(profit_by_ship_type)
print(profit_by_engine_type)
print(profit_by_route_type)
```

Profitability by Ship Type: Fish Carriers generate the highest average profit, while Bulk Carriers generate the highest total profit.
Profitability by Engine Type: Diesel and Steam Turbine engines are more profitable than Heavy Fuel Oil engines.
Profitability by Route Type: Long-haul routes are the most profitable, while Transoceanic routes have the lowest average profit.

```{r}
#| code-fold: true
#| code-summary: "Click here to show the R code"
#| eval: false
df_new <- df %>%
  mutate(Profit_per_Voyage_USD = Revenue_per_Voyage_USD - Operational_Cost_USD)

# Analyze Profit by Ship_Type
profit_by_ship_type <- df_new %>%
  group_by(Ship_Type) %>%
  summarise(Average_Profit = mean(Profit_per_Voyage_USD),
            Total_Profit = sum(Profit_per_Voyage_USD),
            Count = n())

# Analyze Profit by Engine_Type
profit_by_engine_type <- df_new %>%
  group_by(Engine_Type) %>%
  summarise(Average_Profit = mean(Profit_per_Voyage_USD),
            Total_Profit = sum(Profit_per_Voyage_USD),
            Count = n())

# Analyze Profit by Route_Type
profit_by_route_type <- df_new %>%
  group_by(Route_Type) %>%
  summarise(Average_Profit = mean(Profit_per_Voyage_USD),
            Total_Profit = sum(Profit_per_Voyage_USD),
            Count = n())

# Display results
print(profit_by_ship_type)
print(profit_by_engine_type)
print(profit_by_route_type)
```

### Plotting the Profitability Analysis

```{r}
#| echo: false

df_new <- df %>%
  mutate(Profit_per_Voyage_USD = Revenue_per_Voyage_USD - Operational_Cost_USD)

# Analyze Profit by Ship_Type, Engine_Type, and Route_Type
profit_analysis <- df_new %>%
  group_by(Ship_Type, Engine_Type, Route_Type) %>%
  summarise(Average_Profit = mean(Profit_per_Voyage_USD),
            Total_Profit = sum(Profit_per_Voyage_USD),
            Count = n(), .groups = 'drop')

# Create ggplot with interactive tooltips
p <- ggplot(profit_analysis, aes(x = Ship_Type, y = Average_Profit, fill = Engine_Type,
                                 text = paste("Ship Type:", Ship_Type,
                                              "<br>Engine Type:", Engine_Type,
                                              "<br>Route Type:", Route_Type,
                                              "<br>Avg Profit (USD):", round(Average_Profit, 2)))) +
  geom_bar(stat = "identity", position = position_dodge()) +
  facet_wrap(~ Route_Type) +
  theme_minimal() +
  labs(title = "Average Profit by Ship Type, Engine Type, and Route Type",
       y = "Average Profit (USD)",
       x = "Ship Type") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Convert ggplot to an interactive plot
ggplotly(p, tooltip = "text")
```

Long-haul and Short-haul routes are more profitable than Coastal or Transoceanic routes.
Ship type doesn't drastically impact profitability, but there are variations in certain categories.
Engine type does not show a major impact on profitability, except in a few cases.
The "Unknown" category shows high variability, suggesting potential data inconsistencies or exceptional cases.

```{r}
#| code-fold: true
#| code-summary: "Click here to show the R code"
#| eval: false

df_new <- df %>%
  mutate(Profit_per_Voyage_USD = Revenue_per_Voyage_USD - Operational_Cost_USD)

# Analyze Profit by Ship_Type, Engine_Type, and Route_Type
profit_analysis <- df_new %>%
  group_by(Ship_Type, Engine_Type, Route_Type) %>%
  summarise(Average_Profit = mean(Profit_per_Voyage_USD),
            Total_Profit = sum(Profit_per_Voyage_USD),
            Count = n(), .groups = 'drop')

# Create ggplot with interactive tooltips
p <- ggplot(profit_analysis, aes(x = Ship_Type, y = Average_Profit, fill = Engine_Type,
                                 text = paste("Ship Type:", Ship_Type,
                                              "<br>Engine Type:", Engine_Type,
                                              "<br>Route Type:", Route_Type,
                                              "<br>Avg Profit (USD):", round(Average_Profit, 2)))) +
  geom_bar(stat = "identity", position = position_dodge()) +
  facet_wrap(~ Route_Type) +
  theme_minimal() +
  labs(title = "Average Profit by Ship Type, Engine Type, and Route Type",
       y = "Average Profit (USD)",
       x = "Ship Type") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Convert ggplot to an interactive plot
ggplotly(p, tooltip = "text")
```

### Ridgeline Plot

```{r}
#| echo: false
ggplot(df_new, aes(x = Profit_per_Voyage_USD, y = Ship_Type, fill = Route_Type)) +
  geom_density_ridges(alpha = 0.7) +
  labs(title = "Ridgeline Plot: Profit Distribution by Ship Type and Route",
       x = "Profit per Voyage (USD)", 
       y = "Ship Type",
       fill = "Route Type") +
  theme_minimal()
```

This is a ridgeline plot, which is used to visualize the distribution of a numerical variable (Profit per Voyage in USD) across multiple categorical groups (Ship Type and Route Type).
The density curves show the profit distribution for each Ship Type and Route Type.
Different ship types experience varying profit distributions, with some being more stable (Bulk Carrier, Container Ship) and others more volatile (Tanker, Fish Carrier).
Route type significantly influences profitability, with Short-haul and Transoceanic routes showing more stable profit distributions.
Some voyages result in losses, particularly for Tanker and Fish Carrier types, suggesting that these ships may have more unpredictable profitability.

```{r}
#| code-fold: true
#| code-summary: "Click here to show the R code"
#| eval: false

ggplot(df_new, aes(x = Profit_per_Voyage_USD, y = Ship_Type, fill = Route_Type)) +
  geom_density_ridges(alpha = 0.7) +
  labs(title = "Ridgeline Plot: Profit Distribution by Ship Type and Route",
       x = "Profit per Voyage (USD)", 
       y = "Ship Type",
       fill = "Route Type") +
  theme_minimal()
```

## Turnaround Analysis

```{r}
#| echo: false
turnaround_analysis <- df %>%
  group_by(Weather_Condition, Route_Type) %>%
  summarise(Average_Turnaround_Time = mean(Turnaround_Time_hours),
            Count = n(), .groups = 'drop')

# Display results
print(turnaround_analysis)
```

Rough weather increases turnaround time, especially for Long-haul and Unknown Route Types.
Shorter routes (Coastal and Short-haul) tend to have lower turnaround times, even under adverse weather conditions.

```{r}
#| code-fold: true
#| code-summary: "Click here to show the R code"
#| eval: false

turnaround_analysis <- df %>%
  group_by(Weather_Condition, Route_Type) %>%
  summarise(Average_Turnaround_Time = mean(Turnaround_Time_hours),
            Count = n(), .groups = 'drop')

# Display results
print(turnaround_analysis)
```

```{r}
#| echo: false
# Visualize Turnaround Time
# Bar plot to show Average Turnaround Time by Weather_Condition and Route_Type
ggplot(turnaround_analysis, aes(x = Weather_Condition, y = Average_Turnaround_Time, fill = Route_Type)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  theme_minimal() +
  labs(title = "Average Turnaround Time by Weather Condition and Route Type",
       y = "Average Turnaround Time (hours)",
       x = "Weather Condition") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
Effect of Weather Conditions on Turnaround Time:

Turnaround time appears to increase slightly from calm to rough weather, especially for Long-haul and Coastal routes.
The impact of weather is relatively minor, suggesting that ships may have efficient contingency plans.
Comparison Between Route Types:

Short-haul and Transoceanic routes have consistently higher turnaround times compared to Coastal and Long-haul routes, regardless of weather conditions.
Long-haul routes experience the highest turnaround time in rough weather, possibly due to longer distances and greater exposure to adverse conditions.
Operational Considerations:

If rough weather significantly increases turnaround time, shipping companies may need better port efficiency strategies or adjustments in scheduling.
Coastal routes may be less affected, indicating shorter processing times at ports.

```{r}
#| code-fold: true
#| code-summary: "Click here to show the R code"
#| eval: false

# Visualize Turnaround Time
# Bar plot to show Average Turnaround Time by Weather_Condition and Route_Type
ggplot(turnaround_analysis, aes(x = Weather_Condition, y = Average_Turnaround_Time, fill = Route_Type)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  theme_minimal() +
  labs(title = "Average Turnaround Time by Weather Condition and Route Type",
       y = "Average Turnaround Time (hours)",
       x = "Weather Condition") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
#| echo: false
df %>%
  group_by(Ship_Type, Route_Type) %>%
  summarise(Avg_Efficiency = mean(Efficiency_nm_per_kWh, na.rm = TRUE), .groups = "drop") %>%
  ggplot(aes(x = Ship_Type, y = Route_Type, fill = Avg_Efficiency)) +
  geom_tile() +
  scale_fill_viridis_c(option = "plasma") +  # Enhances color visibility
  theme_minimal() +
  labs(title = "Heatmap of Average Efficiency by Ship Type and Route Type",
       x = "Ship Type",
       y = "Route Type",
       fill = "Avg Efficiency (nm/kWh)") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
Long-haul and Transoceanic routes generally exhibit lower efficiency (dark blue and purple), particularly for Tankers and Fish Carriers.
This suggests that fuel consumption increases significantly for longer distances, possibly due to higher cargo weights, fuel type inefficiencies, or unfavorable sea conditions.
Container Ships have moderate efficiency across all routes, possibly due to optimized fuel consumption and operational strategies.
Bulk Carriers and Tankers show variable efficiency depending on the route type.
Fish Carriers consistently exhibit low efficiency, which could be linked to frequent stops, variable cargo loads, or operational inefficiencies.

```{r}
#| code-fold: true
#| code-summary: "Click here to show the R code"
#| eval: false

df %>%
  group_by(Ship_Type, Route_Type) %>%
  summarise(Avg_Efficiency = mean(Efficiency_nm_per_kWh, na.rm = TRUE), .groups = "drop") %>%
  ggplot(aes(x = Ship_Type, y = Route_Type, fill = Avg_Efficiency)) +
  geom_tile() +
  scale_fill_viridis_c(option = "plasma") +  # Enhances color visibility
  theme_minimal() +
  labs(title = "Heatmap of Average Efficiency by Ship Type and Route Type",
       x = "Ship Type",
       y = "Route Type",
       fill = "Avg Efficiency (nm/kWh)") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## Advanced Data Visualisation

### Interactive Plots

```{r}
#| echo: false
# Get unique Route Types
route_types <- unique(df$Route_Type)

# Create a scatter plot for each Route Type but set them hidden by default
plot_list <- list()
visibility_list <- list()

# ✅ Create the traces for each Route Type
for (i in seq_along(route_types)) {
  route_data <- df %>% filter(Route_Type == route_types[i])
  
  plot_list[[i]] <- list(
    x = jitter(route_data$Operational_Cost_USD, amount = 10000),  # ✅ Reduce overlap
    y = jitter(route_data$Revenue_per_Voyage_USD, amount = 10000),
    mode = "markers",
    type = "scatter",  # ✅ Explicitly specify scatter type
    marker = list(size = route_data$Cargo_Weight_tons / 100,  # ✅ Reduce bubble size
                  opacity = 0.6),  # ✅ Make bubbles slightly transparent
    name = route_types[i],  # Legend name
    text = paste(
      "Ship Type:", route_data$Ship_Type,
      "<br>Engine Type:", route_data$Engine_Type,
      "<br>Maintenance Status:", route_data$Maintenance_Status,
      "<br>Cargo Weight (tons):", route_data$Cargo_Weight_tons,
      "<br>Profit (USD):", route_data$Profit
    ),
    hoverinfo = "text",
    visible = ifelse(i == 1, TRUE, "legendonly")  # ✅ Show only first Route Type initially
  )
}

# ✅ Create "All" Option to show all Route Types
all_visibility <- rep(TRUE, length(plot_list))  # ✅ Ensures all traces are visible when "All" is selected

# ✅ Add "All" Button for Dropdown
all_button <- list(
  method = "update",
  args = list(list(visible = all_visibility)),
  label = "All"
)

# ✅ Add Individual Route Type Buttons
for (i in seq_along(route_types)) {
  visibility_list[[i]] <- list(
    method = "update",
    args = list(list(visible = rep(FALSE, length(route_types)))),
    label = route_types[i]
  )
  visibility_list[[i]]$args[[1]]$visible[i] <- TRUE
}

# ✅ Add "All" option at the start of the dropdown
visibility_list <- append(list(all_button), visibility_list)

# ✅ Create Plotly Figure
p <- plot_ly()

for (plot in plot_list) {
  p <- add_trace(p, x = plot$x, y = plot$y, mode = plot$mode, 
                 type = "scatter",  # ✅ Explicitly specify scatter type
                 marker = plot$marker, name = plot$name, 
                 text = plot$text, hoverinfo = plot$hoverinfo, visible = plot$visible)
}

# ✅ Add dropdown filter with "All" option
p <- layout(p,
            title = "Operational Cost vs Revenue (Filtered by Route Type)",
            xaxis = list(title = "Operational Cost (USD)"),
            yaxis = list(title = "Revenue per Voyage (USD)"),
            showlegend = TRUE,
            updatemenus = list(
              list(
                buttons = visibility_list,
                direction = "down",
                showactive = TRUE,
                x = 0.15,  # Position of dropdown
                y = 1.15
              )
            ))

# ✅ Display the plot
p
```

Revenue Increases with Operational Cost but with High Variability

While there is some correlation between operational cost and revenue, the scatter pattern suggests high variability, meaning that higher operational cost does not always lead to higher revenue.
Overlap Among Route Types

The five route types overlap significantly, meaning that no single route type has a clear advantage in terms of cost vs. revenue.
This suggests that other factors, such as cargo type, fuel efficiency, and weather conditions, might play a bigger role in determining revenue.
Clusters of High-Cost, High-Revenue Voyages

Some bubbles are concentrated in the top-right quadrant, representing voyages with both high operational costs and high revenue.
These voyages could correspond to high-value cargo or long-distance shipments.
Presence of Low Revenue, High Operational Cost Voyages

There are some voyages with high operational costs but relatively low revenue.
These may represent inefficient voyages, poor cargo utilization, or increased fuel consumption due to weather or maintenance issues.

```{r}
#| code-fold: true
#| code-summary: "Click here to show the R code"
#| eval: false

# Get unique Route Types
route_types <- unique(df$Route_Type)

# Create a scatter plot for each Route Type but set them hidden by default
plot_list <- list()
visibility_list <- list()

# ✅ Create the traces for each Route Type
for (i in seq_along(route_types)) {
  route_data <- df %>% filter(Route_Type == route_types[i])
  
  plot_list[[i]] <- list(
    x = jitter(route_data$Operational_Cost_USD, amount = 10000),  # ✅ Reduce overlap
    y = jitter(route_data$Revenue_per_Voyage_USD, amount = 10000),
    mode = "markers",
    type = "scatter",  # ✅ Explicitly specify scatter type
    marker = list(size = route_data$Cargo_Weight_tons / 100,  # ✅ Reduce bubble size
                  opacity = 0.6),  # ✅ Make bubbles slightly transparent
    name = route_types[i],  # Legend name
    text = paste(
      "Ship Type:", route_data$Ship_Type,
      "<br>Engine Type:", route_data$Engine_Type,
      "<br>Maintenance Status:", route_data$Maintenance_Status,
      "<br>Cargo Weight (tons):", route_data$Cargo_Weight_tons,
      "<br>Profit (USD):", route_data$Profit
    ),
    hoverinfo = "text",
    visible = ifelse(i == 1, TRUE, "legendonly")  # ✅ Show only first Route Type initially
  )
}

# ✅ Create "All" Option to show all Route Types
all_visibility <- rep(TRUE, length(plot_list))  # ✅ Ensures all traces are visible when "All" is selected

# ✅ Add "All" Button for Dropdown
all_button <- list(
  method = "update",
  args = list(list(visible = all_visibility)),
  label = "All"
)

# ✅ Add Individual Route Type Buttons
for (i in seq_along(route_types)) {
  visibility_list[[i]] <- list(
    method = "update",
    args = list(list(visible = rep(FALSE, length(route_types)))),
    label = route_types[i]
  )
  visibility_list[[i]]$args[[1]]$visible[i] <- TRUE
}

# ✅ Add "All" option at the start of the dropdown
visibility_list <- append(list(all_button), visibility_list)

# ✅ Create Plotly Figure
p <- plot_ly()

for (plot in plot_list) {
  p <- add_trace(p, x = plot$x, y = plot$y, mode = plot$mode, 
                 type = "scatter",  # ✅ Explicitly specify scatter type
                 marker = plot$marker, name = plot$name, 
                 text = plot$text, hoverinfo = plot$hoverinfo, visible = plot$visible)
}

# ✅ Add dropdown filter with "All" option
p <- layout(p,
            title = "Operational Cost vs Revenue (Filtered by Route Type)",
            xaxis = list(title = "Operational Cost (USD)"),
            yaxis = list(title = "Revenue per Voyage (USD)"),
            showlegend = TRUE,
            updatemenus = list(
              list(
                buttons = visibility_list,
                direction = "down",
                showactive = TRUE,
                x = 0.15,  # Position of dropdown
                y = 1.15
              )
            ))

# ✅ Display the plot
p
```

## Time-Series Analysis

```{r}
#| echo: false
# Compute Monthly Aggregation (Sum) by Route Type
df_monthly <- df %>%
  mutate(Month = floor_date(Date, "month")) %>%  # ✅ Extract month
  group_by(Route_Type, Month) %>%
  summarise(
    Total_Operational_Cost = sum(Operational_Cost_USD, na.rm = TRUE),
    Total_Revenue = sum(Revenue_per_Voyage_USD, na.rm = TRUE),
    Total_Profit = sum(Revenue_per_Voyage_USD, na.rm = TRUE) - sum(Operational_Cost_USD, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  arrange(Month)  # ✅ Ensure months are sorted correctly

# Get unique Route Types & Months
route_types <- unique(df_monthly$Route_Type)
month_list <- unique(df_monthly$Month)

# Initialize storage for traces
plot_list <- list()

# ✅ Create a scatter plot for each Route Type & Month (All visible)
for (i in seq_along(route_types)) {
  for (j in seq_along(month_list)) {
    
    route_month_data <- df_monthly %>% 
      filter(Route_Type == route_types[i], Month == month_list[j])
    
    if (nrow(route_month_data) > 0) {
      trace <- list(
        x = jitter(route_month_data$Total_Operational_Cost, amount = 50000),  # ✅ Reduce clustering
        y = jitter(route_month_data$Total_Revenue, amount = 50000),
        mode = "markers",
        type = "scatter",  # ✅ Explicitly specify scatter type
        marker = list(size = route_month_data$Total_Profit / 1000000, opacity = 0.7),  # ✅ Scaled size & transparency
        name = paste(route_types[i], format(month_list[j], "%B %Y")),  # ✅ Improve legend readability
        text = paste(
          "Route Type:", route_types[i],
          "<br>Month:", format(route_month_data$Month, "%B %Y"),
          "<br>Total Operational Cost: $", formatC(route_month_data$Total_Operational_Cost, big.mark = ","),
          "<br>Total Revenue: $", formatC(route_month_data$Total_Revenue, big.mark = ","),
          "<br>Total Profit: $", formatC(route_month_data$Total_Profit, big.mark = ",")
        ),
        hoverinfo = "text",
        visible = TRUE  # ✅ Show all by default
      )
      
      plot_list[[length(plot_list) + 1]] <- trace
    }
  }
}

# ✅ Create Plotly figure (No dropdowns, uses legend instead)
p <- plot_ly()

for (plot in plot_list) {
  p <- add_trace(p, x = plot$x, y = plot$y, mode = plot$mode, 
                 type = "scatter",
                 marker = plot$marker, name = plot$name, 
                 text = plot$text, hoverinfo = plot$hoverinfo, visible = plot$visible)
}

# ✅ Improved Layout
p <- layout(p,
            title = "Total Monthly Operational Cost vs Revenue",
            xaxis = list(title = "Total Operational Cost (USD)"),
            yaxis = list(title = "Total Revenue (USD)"),
            showlegend = TRUE  # ✅ Users can toggle visibility via the legend
)

# ✅ Display the plot
p
```

This interactive chart provides valuable insights into how operational costs impact revenue across different shipping routes and months. User can select the route type and months for easy comparison.
It highlights potential profitable routes, seasonal trends, and areas for operational improvement.
Government officials and shipping companies can use this data to make better strategic decisions to improve efficiency and profitability. 

```{r}
#| code-fold: true
#| code-summary: "Click here to show the R code"
#| eval: false

# Compute Monthly Aggregation (Sum) by Route Type
df_monthly <- df %>%
  mutate(Month = floor_date(Date, "month")) %>%  # ✅ Extract month
  group_by(Route_Type, Month) %>%
  summarise(
    Total_Operational_Cost = sum(Operational_Cost_USD, na.rm = TRUE),
    Total_Revenue = sum(Revenue_per_Voyage_USD, na.rm = TRUE),
    Total_Profit = sum(Revenue_per_Voyage_USD, na.rm = TRUE) - sum(Operational_Cost_USD, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  arrange(Month)  # ✅ Ensure months are sorted correctly

# Get unique Route Types & Months
route_types <- unique(df_monthly$Route_Type)
month_list <- unique(df_monthly$Month)

# Initialize storage for traces
plot_list <- list()

# ✅ Create a scatter plot for each Route Type & Month (All visible)
for (i in seq_along(route_types)) {
  for (j in seq_along(month_list)) {
    
    route_month_data <- df_monthly %>% 
      filter(Route_Type == route_types[i], Month == month_list[j])
    
    if (nrow(route_month_data) > 0) {
      trace <- list(
        x = jitter(route_month_data$Total_Operational_Cost, amount = 50000),  # ✅ Reduce clustering
        y = jitter(route_month_data$Total_Revenue, amount = 50000),
        mode = "markers",
        type = "scatter",  # ✅ Explicitly specify scatter type
        marker = list(size = route_month_data$Total_Profit / 1000000, opacity = 0.7),  # ✅ Scaled size & transparency
        name = paste(route_types[i], format(month_list[j], "%B %Y")),  # ✅ Improve legend readability
        text = paste(
          "Route Type:", route_types[i],
          "<br>Month:", format(route_month_data$Month, "%B %Y"),
          "<br>Total Operational Cost: $", formatC(route_month_data$Total_Operational_Cost, big.mark = ","),
          "<br>Total Revenue: $", formatC(route_month_data$Total_Revenue, big.mark = ","),
          "<br>Total Profit: $", formatC(route_month_data$Total_Profit, big.mark = ",")
        ),
        hoverinfo = "text",
        visible = TRUE  # ✅ Show all by default
      )
      
      plot_list[[length(plot_list) + 1]] <- trace
    }
  }
}

# ✅ Create Plotly figure (No dropdowns, uses legend instead)
p <- plot_ly()

for (plot in plot_list) {
  p <- add_trace(p, x = plot$x, y = plot$y, mode = plot$mode, 
                 type = "scatter",
                 marker = plot$marker, name = plot$name, 
                 text = plot$text, hoverinfo = plot$hoverinfo, visible = plot$visible)
}

# ✅ Improved Layout
p <- layout(p,
            title = "Total Monthly Operational Cost vs Revenue",
            xaxis = list(title = "Total Operational Cost (USD)"),
            yaxis = list(title = "Total Revenue (USD)"),
            showlegend = TRUE  # ✅ Users can toggle visibility via the legend
)

# ✅ Display the plot
p
```

```{r}
#| echo: false
# Summarize the data with averages
summary_data <- df %>%
  group_by(Date, Maintenance_Status) %>%
  summarise(
    Avg_Operational_Cost = mean(Operational_Cost_USD, na.rm = TRUE),
    Avg_Revenue = mean(Revenue_per_Voyage_USD, na.rm = TRUE),
    Avg_Profit = mean(Profit, na.rm = TRUE),
    .groups = "drop"
  ) 

# Convert Date to character for animation
summary_data$Date <- as.character(summary_data$Date)

# Scale sizes
size_scaled <- scales::rescale(summary_data$Avg_Operational_Cost, to = c(5, 50))

# **Fix: Ensure Maintenance_Status is not required in breakeven_data**
breakeven_data <- data.frame(
  x = c(min(summary_data$Avg_Operational_Cost, na.rm = TRUE), max(summary_data$Avg_Operational_Cost, na.rm = TRUE)),
  y = c(min(summary_data$Avg_Operational_Cost, na.rm = TRUE), max(summary_data$Avg_Operational_Cost, na.rm = TRUE))
)

# Create animated scatter plot
bp <- plot_ly(
  data = summary_data,
  x = ~Avg_Operational_Cost, 
  y = ~Avg_Revenue, 
  size = ~size_scaled,  
  color = ~Maintenance_Status,  # ✅ Keep this only in animated points
  frame = ~Date,  
  text = ~paste("Date:", Date,
                "<br>Maintenance Status:", Maintenance_Status,
                "<br>Avg Profit (USD):", Avg_Profit),
  hoverinfo = "text",
  type = 'scatter', 
  mode = 'markers'
) %>%

  # **Fix: Add breakeven line separately (no Maintenance_Status)**
  add_trace(
    data = breakeven_data,
    x = ~x, 
    y = ~y, 
    type = 'scatter',
    mode = 'lines',
    line = list(color = 'black', dash = 'dot'),
    name = 'Breakeven Line',
    inherit = FALSE  # ✅ Ensure no missing column issues
  ) %>%

  # Layout settings
  layout(
    title = "Average Operational Cost vs Revenue per Voyage (with Breakeven Line)",
    xaxis = list(title = "Average Operational Cost (USD)"),
    yaxis = list(title = "Average Revenue per Voyage (USD)"),
    showlegend = TRUE
  ) %>%

  # Slow down animation
  animation_opts(
    frame = 300,  # Slower animation
    easing = "linear",
    redraw = TRUE
  ) %>%

  # Animation slider settings
  animation_slider(
    currentvalue = list(prefix = "Date: ")
  )

# Display the plot
bp
```

This interactive chart allows user to view the revenue and cost over a time period.
High operational costs do not always translate to higher revenue.
Ships in “Unknown” maintenance status are incurring losses—data collection or maintenance intervention is needed.
Ships in “Good” and “Critical” condition tend to be profitable, meaning investment in regular maintenance can be beneficial.
Further analysis is needed to determine if specific ship types or routes contribute to profit/loss.

```{r}
#| code-fold: true
#| code-summary: "Click here to show the R code"
#| eval: false

# Summarize the data with averages
summary_data <- df %>%
  group_by(Date, Maintenance_Status) %>%
  summarise(
    Avg_Operational_Cost = mean(Operational_Cost_USD, na.rm = TRUE),
    Avg_Revenue = mean(Revenue_per_Voyage_USD, na.rm = TRUE),
    Avg_Profit = mean(Profit, na.rm = TRUE),
    .groups = "drop"
  ) 

# Convert Date to character for animation
summary_data$Date <- as.character(summary_data$Date)

# Scale sizes
size_scaled <- scales::rescale(summary_data$Avg_Operational_Cost, to = c(5, 50))

# **Fix: Ensure Maintenance_Status is not required in breakeven_data**
breakeven_data <- data.frame(
  x = c(min(summary_data$Avg_Operational_Cost, na.rm = TRUE), max(summary_data$Avg_Operational_Cost, na.rm = TRUE)),
  y = c(min(summary_data$Avg_Operational_Cost, na.rm = TRUE), max(summary_data$Avg_Operational_Cost, na.rm = TRUE))
)

# Create animated scatter plot
bp <- plot_ly(
  data = summary_data,
  x = ~Avg_Operational_Cost, 
  y = ~Avg_Revenue, 
  size = ~size_scaled,  
  color = ~Maintenance_Status,  # ✅ Keep this only in animated points
  frame = ~Date,  
  text = ~paste("Date:", Date,
                "<br>Maintenance Status:", Maintenance_Status,
                "<br>Avg Profit (USD):", Avg_Profit),
  hoverinfo = "text",
  type = 'scatter', 
  mode = 'markers'
) %>%

  # **Fix: Add breakeven line separately (no Maintenance_Status)**
  add_trace(
    data = breakeven_data,
    x = ~x, 
    y = ~y, 
    type = 'scatter',
    mode = 'lines',
    line = list(color = 'black', dash = 'dot'),
    name = 'Breakeven Line',
    inherit = FALSE  # ✅ Ensure no missing column issues
  ) %>%

  # Layout settings
  layout(
    title = "Average Operational Cost vs Revenue per Voyage (with Breakeven Line)",
    xaxis = list(title = "Average Operational Cost (USD)"),
    yaxis = list(title = "Average Revenue per Voyage (USD)"),
    showlegend = TRUE
  ) %>%

  # Slow down animation
  animation_opts(
    frame = 300,  # Slower animation
    easing = "linear",
    redraw = TRUE
  ) %>%

  # Animation slider settings
  animation_slider(
    currentvalue = list(prefix = "Date: ")
  )

# Display the plot
bp
```

## Profitability Distribution Across Ship Types

```{r}
#| echo: false
# Flip the axes
ggplot(df, 
       aes(x = Ship_Type, 
           y = Profit, 
           fill = Maintenance_Status)) +
  
  # Half-eye density plot (horizontal)
  stat_halfeye(adjust = 0.5,
               justification = -0.2,
               .width = 0,
               point_colour = NA,
               alpha = 0.6) +
  
  # Boxplot (horizontal)
  geom_boxplot(width = 0.2, 
               outlier.shape = NA,
               alpha = 0.8) +
  
  # Dot plot (horizontal)
  stat_dots(side = "left",
            justification = 1.2,
            binwidth = NA,  
            overflow = "compress",
            dotsize = 0.6) +  
  
  # Flip coordinates to make it horizontal
  coord_flip() +
  
  # Titles and theme
  labs(title = "Profitability Distribution Across Ship Types",
       x = "Ship Type", 
       y = "Profit per Voyage (USD)",
       fill = "Maintenance Status") +
  
  theme_minimal()  # Clean visualization
```

Ships in Good Maintenance (Blue) Show Higher and Stable Profits
Across all ship types, ships in Good maintenance condition (blue) tend to have higher profitability and a more concentrated distribution towards positive profit.
This suggests that well-maintained ships yield better financial performance with fewer loss-making voyages.

Bulk Carriers and Container Ships Exhibit Stable Profitability
Bulk Carriers and Container Ships have relatively consistent profit distributions, as seen from their dense and symmetrical violin shapes.
They experience fewer extreme losses compared to other ship types.
The tighter boxplots indicate less profit volatility, making them a safer investment.

Tankers and Fish Carriers Show Higher Profit Variability
Tankers and Fish Carriers display wider violin plots, suggesting high profit variability.
While they have potential for high profits, they also experience more fluctuating earnings.
The spread of profits into negative values indicates some loss-making voyages.

Ships in Critical Condition (Red) Have Higher Chances of Loss
The Critical maintenance category (red) is skewed towards lower profits and losses.
This suggests that poor maintenance is linked to lower revenue and increased operational costs.
Fish Carriers in Critical maintenance seem to be particularly unprofitable.

Unknown Maintenance Status (Purple) Shows an Unusual Trend
Ships with Unknown maintenance status have the most unpredictable profit spread.
Some unknown-status ships perform well, while others face high losses, suggesting data quality issues or inconsistent maintenance tracking.

The boxplots for Container Ships are relatively tighter, meaning their profits are more stable compared to other ship types.

```{r}
#| code-fold: true
#| code-summary: "Click here to show the R code"
#| eval: false

# Flip the axes
ggplot(df, 
       aes(x = Ship_Type, 
           y = Profit, 
           fill = Maintenance_Status)) +
  
  # Half-eye density plot (horizontal)
  stat_halfeye(adjust = 0.5,
               justification = -0.2,
               .width = 0,
               point_colour = NA,
               alpha = 0.6) +
  
  # Boxplot (horizontal)
  geom_boxplot(width = 0.2, 
               outlier.shape = NA,
               alpha = 0.8) +
  
  # Dot plot (horizontal)
  stat_dots(side = "left",
            justification = 1.2,
            binwidth = NA,  
            overflow = "compress",
            dotsize = 0.6) +  
  
  # Flip coordinates to make it horizontal
  coord_flip() +
  
  # Titles and theme
  labs(title = "Profitability Distribution Across Ship Types",
       x = "Ship Type", 
       y = "Profit per Voyage (USD)",
       fill = "Maintenance Status") +
  
  theme_minimal()  # Clean visualization
```

## Statistical Testing (ANOVA)

```{r}
#| echo: false

# Run ANOVA for each Ship Type & Engine Type
anova_results <- list()

for (ship in unique(df$Ship_Type)) {
  for (engine in unique(df$Engine_Type)) {
    
    # Subset the data
    subset_data <- df %>%
      filter(Ship_Type == ship, Engine_Type == engine)
    
    # Ensure there are at least 2 unique Maintenance Status levels
    if (length(unique(subset_data$Maintenance_Status)) > 1) {
      
      # Run ANOVA
      anova_model <- aov(Operational_Cost_USD ~ Maintenance_Status, data = subset_data)
      
      # Store results
      anova_results[[paste(ship, engine, sep = " - ")]] <- summary(anova_model)
    }
  }
}

# Print results
anova_results
```

```{r}
#| code-fold: true
#| code-summary: "Click here to show the R code"
#| eval: false

# Run ANOVA for each Ship Type & Engine Type
anova_results <- list()

for (ship in unique(df$Ship_Type)) {
  for (engine in unique(df$Engine_Type)) {
    
    # Subset the data
    subset_data <- df %>%
      filter(Ship_Type == ship, Engine_Type == engine)
    
    # Ensure there are at least 2 unique Maintenance Status levels
    if (length(unique(subset_data$Maintenance_Status)) > 1) {
      
      # Run ANOVA
      anova_model <- aov(Operational_Cost_USD ~ Maintenance_Status, data = subset_data)
      
      # Store results
      anova_results[[paste(ship, engine, sep = " - ")]] <- summary(anova_model)
    }
  }
}

# Print results
anova_results
```

### Container Ship - Steam Turbine

p-value: 0.00268 (Significant at the 0.01 level)
Interpretation: There is a significant difference in operational costs across different maintenance statuses (p \< 0.05). You can explore which maintenance levels contribute to the difference using post-hoc tests (e.g., Tukey HSD).

### Bulk Carrier - Heavy Fuel Oil (HFO)

p-value: 0.00447 (Significant at the 0.01 level)
Interpretation: There is a significant difference in operational costs across different maintenance statuses (p \< 0.05). Again, post-hoc tests like Tukey HSD can be run to identify which maintenance statuses differ.

```{r}
#| echo: false

# Filter the dataset for Bulk Carrier and Heavy Fuel Oil (HFO)
container_ship_steamturbine_data <- subset(df, Ship_Type == "Container Ship" & Engine_Type == "Steam Turbine")

# Run ANOVA for Operational Cost by Maintenance Status
anova_model_hfo <- aov(Operational_Cost_USD ~ Maintenance_Status, data = container_ship_steamturbine_data)

# Run the Tukey HSD test
tukey_test <- TukeyHSD(anova_model_hfo)

# Print the results of the Tukey test
print(tukey_test)
```

```{r}
#| code-fold: true
#| code-summary: "Click here to show the R code"
#| eval: false

# Filter the dataset for Bulk Carrier and Heavy Fuel Oil (HFO)
container_ship_steamturbine_data <- subset(df, Ship_Type == "Container Ship" & Engine_Type == "Steam Turbine")

# Run ANOVA for Operational Cost by Maintenance Status
anova_model_hfo <- aov(Operational_Cost_USD ~ Maintenance_Status, data = container_ship_steamturbine_data)

# Run the Tukey HSD test
tukey_test <- TukeyHSD(anova_model_hfo)

# Print the results of the Tukey test
print(tukey_test)
```

::: callout-tip
#### Tukey HSD test results for the Container Ship (Steam Turbine) above:

Fair vs. Critical:

The difference in operational costs between “Fair” and “Critical” maintenance statuses is 38,212.87 USD.
The confidence interval for this difference ranges from -24,359.90 USD to 100,785.63 USD.
The p-value is 0.3912, which is not statistically significant (p > 0.05).
This suggests that operational costs do not significantly differ between the “Fair” and “Critical” maintenance statuses.

Good vs. Critical:

The difference in operational costs between “Good” and “Critical” maintenance statuses is 73,962.84 USD.
The confidence interval for this difference ranges from 10,672.03 USD to 137,253.64 USD.
The p-value is 0.0147, which is statistically significant (p < 0.05).
This indicates that operational costs are significantly different between the “Good” and “Critical” maintenance statuses.

Unknown vs. Critical:

The difference in operational costs between “Unknown” and “Critical” maintenance statuses is -63,383.95 USD.
The confidence interval for this difference ranges from -180,561.98 USD to 53,794.09 USD.
The p-value is 0.5000, which is not statistically significant (p > 0.05).
This suggests that operational costs do not significantly differ between the “Unknown” and “Critical” maintenance statuses.

Good vs. Fair:

The difference in operational costs between “Good” and “Fair” maintenance statuses is 35,749.97 USD.
The confidence interval for this difference ranges from -27,070.43 USD to 98,570.37 USD.
The p-value is 0.4550, which is not statistically significant (p > 0.05).
This suggests that operational costs do not significantly differ between the “Good” and “Fair” maintenance statuses.

Unknown vs. Fair:

The difference in operational costs between “Unknown” and “Fair” maintenance statuses is -101,596.81 USD.
The confidence interval for this difference ranges from -218,521.44 USD to 15,327.81 USD.
The p-value is 0.1133, which is not statistically significant (p > 0.05).
This suggests that operational costs do not significantly differ between the “Unknown” and “Fair” maintenance statuses.

Unknown vs. Good:

The difference in operational costs between “Unknown” and “Good” maintenance statuses is -137,346.78 USD.
The confidence interval for this difference ranges from -254,657.24 USD to -20,036.32 USD.
The p-value is 0.0144, which is statistically significant (p < 0.05).
This indicates that operational costs are significantly different between the “Unknown” and “Good” maintenance statuses. 

:::

```{r}
#| echo: false

# Filter the dataset for Bulk Carrier and Heavy Fuel Oil (HFO)
bulk_carrier_hfo_data <- subset(df, Ship_Type == "Bulk Carrier" & Engine_Type == "Heavy Fuel Oil (HFO)")

# Run ANOVA for Operational Cost by Maintenance Status
anova_model_hfo <- aov(Operational_Cost_USD ~ Maintenance_Status, data = bulk_carrier_hfo_data)

# Run the Tukey HSD test
tukey_test <- TukeyHSD(anova_model_hfo)

# Print the results of the Tukey test
print(tukey_test)
```

```{r}
#| code-fold: true
#| code-summary: "Click here to show the R code"
#| eval: false

# Filter the dataset for Bulk Carrier and Heavy Fuel Oil (HFO)
bulk_carrier_hfo_data <- subset(df, Ship_Type == "Bulk Carrier" & Engine_Type == "Heavy Fuel Oil (HFO)")

# Run ANOVA for Operational Cost by Maintenance Status
anova_model_hfo <- aov(Operational_Cost_USD ~ Maintenance_Status, data = bulk_carrier_hfo_data)

# Run the Tukey HSD test
tukey_test <- TukeyHSD(anova_model_hfo)

# Print the results of the Tukey test
print(tukey_test)
```

::: callout-tip
#### Tukey HSD test results for the Bulk Carrier (HFO) above:

Fair vs. Critical:

The difference in operational costs between “Fair” and “Critical” maintenance statuses is -69,725.36 USD.
The confidence interval for this difference ranges from -129,594.48 USD to -9,856.25 USD.
The p-value is 0.0151, which is statistically significant (p < 0.05).
This indicates that operational costs are significantly different between the “Fair” and “Critical” maintenance statuses.

Good vs. Critical:

The difference in operational costs between “Good” and “Critical” maintenance statuses is 1,776.48 USD.
The confidence interval for this difference ranges from -61,914.71 USD to 65,467.67 USD.
The p-value is 0.9999, which is not statistically significant (p > 0.05).
This suggests that operational costs do not significantly differ between the “Good” and “Critical” maintenance statuses.

Unknown vs. Critical:

The difference in operational costs between “Unknown” and “Critical” maintenance statuses is -85,714.28 USD.
The confidence interval for this difference ranges from -207,855.52 USD to 36,426.95 USD.
The p-value is 0.2680, which is not statistically significant (p > 0.05).
This suggests that operational costs do not significantly differ between the “Unknown” and “Critical” maintenance statuses.

Good vs. Fair:

The difference in operational costs between “Good” and “Fair” maintenance statuses is 71,501.84 USD.
The confidence interval for this difference ranges from 6,307.41 USD to 136,696.28 USD.
The p-value is 0.0253, which is statistically significant (p < 0.05).
This indicates that operational costs are significantly different between the “Good” and “Fair” maintenance statuses.

Unknown vs. Fair:

The difference in operational costs between “Unknown” and “Fair” maintenance statuses is -15,988.92 USD.
The confidence interval for this difference ranges from -138,920.72 USD to 106,942.88 USD.
The p-value is 0.9868, which is not statistically significant (p > 0.05).
This suggests that operational costs do not significantly differ between the “Unknown” and “Fair” maintenance statuses.

Unknown vs. Good:

The difference in operational costs between “Unknown” and “Good” maintenance statuses is -87,490.76 USD.
The confidence interval for this difference ranges from -212,328.60 USD to 37,347.07 USD.
The p-value is 0.2692, which is not statistically significant (p > 0.05).
This suggests that operational costs do not significantly differ between the “Unknown” and “Good” maintenance statuses.
:::

# Summary and Conclusion

## Profitability Analysis Across Different Variables

### 1. Weather Condition and Route Type

Turnaround time increases with worsening weather conditions (Calm → Moderate → Rough). Long-haul routes experience the longest delays in rough weather, which may impact profitability. Coastal and Transoceanic routes have similar turnaround times across all weather conditions. Conclusion: Weather conditions impact efficiency, and rough conditions can reduce profitability due to increased delays. 

### 2. Distance Traveled, Cargo Weight, and Route Type 

No clear trend showing a direct relationship between distance traveled and turnaround time. Larger cargo weight does not necessarily lead to longer turnaround times. Conclusion: Efficient scheduling and loading processes likely help mitigate the impact of travel distance and cargo weight on turnaround time. 

### 3. Ship Type and Efficiency Efficiency (nm/kWh) varies significantly across ship types and route types.

Transoceanic routes show the greatest variation in efficiency, with some ship types performing much better than others. Conclusion: The choice of ship type plays a crucial role in energy efficiency and, consequently, profitability. 

### 4. Profitability Distribution Across Ship Types Different ship types show varying profitability distributions, with some ship types being more profitable on average. 

Maintenance status plays a role in profitability, with "Good" maintenance status correlating with higher profit levels. Conclusion: Preventive maintenance and proper upkeep can significantly enhance profitability across different ship types.

Route Type & Weather: Routes affected by rough weather have longer turnaround times, impacting operational costs. Distance & Cargo Weight: Distance traveled and cargo weight do not significantly impact turnaround time, indicating efficient operations. Ship Type & Efficiency: Certain ship types are significantly more efficient, and using the most efficient ships on specific routes can increase profitability. Maintenance & Profitability: Well-maintained ships consistently yield higher profitability, emphasizing the importance of scheduled maintenance. Overall, optimizing ship maintenance, selecting the right ship type for each route, and managing turnaround times in challenging weather conditions can improve profitability. 

# References

Alice Vervaeke. (2025). *Deep waters: The Maritime Security Landscape in the Gulf of Guinea. European Union Institute for Security Studies.* Retrieved from <https://www.iss.europa.eu/publications/briefs/deep-waters-maritime-security-landscape-gulf-guinea>

Kam, Tin Seong. (2023). *Visualising Distribution. R for Visual Analytics.* Retrieved from <https://r4va.netlify.app/chap09>

Antoniadis, A. (2020). Photo by Anastasios Antoniadis on unsplash. Retrieved from <https://unsplash.com/photos/cargo-ship-on-sea-under-cloudy-sky-during-daytime-AMXFr97d00c?utm_content=creditShareLink&utm_medium=referral&utm_source=unsplash>
